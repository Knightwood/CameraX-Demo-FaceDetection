## 自定义界面

### 从BaseCameraXFragment自定义界面

### 从BaseCameraXActivity自定义界面

### 从最基础的CameraXFragment自定义界面

## 自定义用例

* `UseCaseHolder` 类初始化预览，拍照用例，录像用例，图像分析用例
* 提供设置初始化用例方法
* 提供分辨率和纵横比筛选方式

### 指定预览与拍照所需要的分辨率与纵横比筛选
修改UseCaseHolder.resolutionSelector变量，提供预览与拍照所需要的分辨率与纵横比筛选

```kotlin
    //指定筛选条件用于预览和拍照
    UseCaseHolder.resolutionSelector = ResolutionSelector.Builder()
        //分辨率筛选
        .setResolutionFilter { supportedSizes, rotationDegrees ->
            supportedSizes
        }
        //纵横比选择策略 16:9 比例
        .setAspectRatioStrategy(AspectRatioStrategy.RATIO_16_9_FALLBACK_AUTO_STRATEGY)
        //分辨率策略选择最高可用分辨率
        .setResolutionStrategy(ResolutionStrategy.HIGHEST_AVAILABLE_STRATEGY)
        //设置允许的分辨率模式。
        .setAllowedResolutionMode(ResolutionSelector.PREFER_CAPTURE_RATE_OVER_HIGHER_RESOLUTION)
        .build()
```

### 修改默认的用例初始化
如默认的初始化不满足需要，可以调用[setInitImpl]方法，提供自己所需要的初始化
示例：使某个类继承自IUseCaseHelper，并实现初始化预览，拍照用例，录像用例，图像分析用例的方法
  ```
  class IMPL:IUseCaseHelper{
  	........省略
   override fun initVideoCapture(
        cameraExecutor: ExecutorService,
        screenAspectRatio: Int,
        rotation: Int,
        size: Size,
        cameraConfig: ManagerConfig
    ): androidx.camera.video.VideoCapture<Recorder> {
        val videoCapture =
            OnceRecorderHelper.getVideoCapture(cameraExecutor, rotation, cameraConfig.recordConfig)
        return videoCapture
    }
    ........省略
    
  }
  val impl =IMPL()
  //在相机初始化之前调用，提供自己的实现
  UseCaseHolder.setInitImpl(impl)
  
  ```

#### 自定义用例组合
在上一步中，我们提供了自定义的初始化用例的实现。  

在相机配置的[用例模式部分](相机配置.md)，我们讲*配置相机启动时的模式就是在指定用例组合*。  

其中有一个用例模式是`customUseCaseGroup`，  

这个模式，在平时是不会起作用的，只有上一步的基础上，于`IUseCaseHelper.initCustomUseCaseList`方法中实现自定义用例组合的初始化，  
和`provideCustomUseCaseList`提供自定义的用例组合，才会起作用。  

示例代码：
```kotlin
  class IMPL:IUseCaseHelper {
    //。。。省略
    override fun initCustomUseCaseList(
        cameraExecutor: ExecutorService,
        screenAspectRatio: Int,
        rotation: Int,
        size: Size,
        cameraConfig: ManagerConfig,
        selectAnalyzer: ImageAnalysis.Analyzer
    ) {
        // 自定义usecase组合
    }

    override fun provideCustomUseCaseList(): List<UseCase> {
        //提供自定义usecase组合
        return emptyList()
    }
    //。。。省略
}

val impl =IMPL()
//在相机初始化之前调用，提供自己的实现
UseCaseHolder.setInitImpl(impl)
```

## 方法调用时序

[new Fragment()]-> [Fragment.onViewCreated]-> [initCameraHolder(生成并初始化CameraHolder)]  
->[CameraXFragmentEventListener.cameraHolderInitStart] -> [CameraXManager.bindLifecycle]  
->[CameraXManager.initManager]->[CameraManagerEventListener.initCameraStart]->initCamera、initUseCase ->绑定UseCase  
->[CameraManagerEventListener.initCameraFinished]->[CameraXFragmentEventListener.cameraHolderInitFinish]  
